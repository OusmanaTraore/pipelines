node('slavejenkins') {

    def  registry = "jpgibart/projet_cd"
    def  registryCredential = 'dockerhub'
    def  dockerImage = ''

    stage('Cloning Git'){       
                git url: 'https://gitlab.com/projetcd/pipelines.git'           
        } 
        
    stage('Git') {
        // Get some code from a GitHub repository
        git url: 'https://gitlab.com/projetcd/devopsapp.git'
    }
        
    withMaven(
        // Maven installation declared in the Jenkins "Global Tool Configuration"
        maven: 'maven') {

      // Run the maven build
      sh "mvn clean package"
    }

    stage('Building-Image') {        
        script {
            dockerImage = docker.build registry + ":1.0"        
        }
    }
    stage('Deploy-Image'){
        script{
            docker.withRegistry('', registryCredential){
                dockerImage.push()             
            }
        } 
    }
}
